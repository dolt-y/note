# Vue Diff 算法详解

## 1. 背景
- Vue 使用 **虚拟 DOM（Virtual DOM）** 来描述 UI 结构。
- 当状态变化时，Vue 会重新生成新的虚拟 DOM 树，然后通过 **diff 算法** 对比新旧虚拟 DOM。
- 目标是找到最小化的更新路径，避免不必要的 DOM 操作，提高性能。

---

## 2. 核心思想
1. **同层比较**：只比较同一层级的节点，不会跨层级比较。  
2. **key 提高效率**：通过 `key` 唯一标识节点，帮助快速复用已有 DOM。  
3. **双端比较算法**：采用 **双指针** 从两端同时扫描，提高 diff 性能。  

---

## 3. 对比流程

### (1) 判断是否为同一节点
- 条件：`key` 相同 且 `tag`（标签类型）相同  
- 如果不同：直接替换整个节点。  

### (2) 更新节点属性
- 对比并更新：`class, style, props, event` 等。  
- 保持原有 DOM，不销毁重建。  

### (3) 更新子节点
Vue 的 **双端比较算法**核心流程：
- 维护四个指针：
  - `oldStartIdx` / `oldEndIdx`
  - `newStartIdx` / `newEndIdx`
- 依次比较：
  1. 旧头 vs 新头  
  2. 旧尾 vs 新尾  
  3. 旧头 vs 新尾（节点可能移到后面）  
  4. 旧尾 vs 新头（节点可能移到前面）  
- 如果以上都不匹配，则用 `key` 建立映射表，快速定位可复用节点。  

### (4) 处理剩余节点
- 新节点数组还有剩余 → 插入到 DOM  
- 旧节点数组还有剩余 → 从 DOM 删除 

---

## 4. 图解示例

例子：  
旧节点: A B C D
新节点: A C B E

过程：  
1. A = A  -> 复用  
2. C = C  -> 复用  
3. B 位置变化 -> 移动  
4. D -> 删除  
5. E -> 新增  

最终结果：`A  C  B  E`

---

## 5. 动图演示

👉 [点击查看 Vue diff 算法动图演示](vue_diff.gif)

该动图展示了 `A B C D → A C B E` 的逐步 diff 过程：  
- **红色箭头**：复用或移动  
- **删除**：节点被移除  
- **新增**：新节点插入  

---

## 6. 为什么要用 key
```vue
<li v-for="item in list" :key="item.id">{{ item.name }}</li>
