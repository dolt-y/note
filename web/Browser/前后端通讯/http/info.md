# http协议

```
HTTP协议是Hypertext Transfer Protocol（超文本传输协议）的缩写，是用于从客户端向服务器传输超文本文档的协议。

HTTP协议是基于TCP/IP协议的，它是一个无状态的协议，也就是说，对于事务的处理没有记忆能力。

HTTP协议是应用层协议，由客户端请求（request）和服务端响应（response）构成。
```

## 为什么HTTP 建立连接需要三次握手？

### 简答
```
第一次握手：客户发送请求，此时服务器知道客户能发；
第二次握手：服务器发送确认，此时客户知道服务器能发能收；
第三次握手：客户发送确认，此时服务器知道客户能收。
```

### 详细
```
HTTP协议建立连接时，需要客户端和服务器之间建立一个TCP连接，三次握手是为了确认双方的接收和发送能力是否正常。

第一次握手：客户端发送一个SYN包（Synchronize Sequence Numbers，同步序列号）到服务器的TCP端口，并进入SYN_SEND状态。

第二次握手：服务器收到SYN包，必须确认客户的SYN（Synchronize）信号，发送一个SYN/ACK包（Synchronize/Acknowledgement，同步/确认），进入SYN_RECV状态。

第三次握手：客户端收到服务器的SYN/ACK包，向服务器发送确认包ACK（Acknowledgement），此包发送完毕，客户端和服务器进入ESTABLISHED状态，完成三次握手。

三次握手完成后，客户端和服务器开始传送数据。

如果服务器或客户端没有收到确认，会超时重传。
```

###
两次握手的问题
历史连接问题：

如果客户端之前发送的SYN包因为网络延迟而滞留，之后又重发了一个新的SYN包

服务器收到滞留的旧SYN包后会直接建立连接

但客户端知道这是旧连接会拒绝，导致服务器资源浪费

同步信息确认：

两次握手只能确认客户端的发送能力和服务器的接收发送能力

无法确认客户端的接收能力和服务器的发送能力是否正常

资源浪费：

服务器在收到第一个SYN后就分配资源，如果客户端不响应，会导致资源被占用

三次握手的必要性
第三次握手解决了以下问题：

防止已失效的连接请求突然到达（解决历史连接问题）

客户端通过第三次握手可以确认这是否是当前想要建立的连接

双方都能确认对方的收发能力正常

客户端确认：自己的收发和对方的收发都正常

服务器确认：自己的收发和对方的收发都正常

协商初始序列号

三次握手确保双方初始序列号(ISN)被正确同步

防止旧的重复连接初始化造成混乱

现实类比
想象打电话时的对话：

A："喂，你能听到我吗？"（第一次握手）

B："我能听到你，你能听到我吗？"（第二次握手）

A："我也能听到你"（第三次握手）

只有经过这三次确认，双方才能确信通信链路是双向可用的。两次确认无法确保双向通信都正常。

因此，三次握手是保证可靠通信的最小次数，既解决了同步问题，又避免了资源浪费。
